; VSS OMNI TELECOM - Asterisk PJSIP Configuration
; Полная конфигурация для работы с Kamailio и слотами

; ============================================
; TRANSPORTS
; ============================================

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
local_net=172.19.0.0/255.255.0.0
local_net=127.0.0.0/255.0.0.0
external_media_address=auto
external_signaling_address=auto

[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060
local_net=172.19.0.0/255.255.0.0
local_net=127.0.0.0/255.0.0.0
external_media_address=auto
external_signaling_address=auto

; ============================================
; TEMPLATES
; ============================================

; Template для слотов
[slot-template](!)
type=endpoint
context=internal
disallow=all
allow=ulaw
allow=alaw
allow=gsm
allow=g722
allow=opus
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=yes
use_avpf=yes
media_encryption=dtls
dtls_auto_generate_cert=yes
transport=transport-udp
aors=slot-aor-template

[slot-aor-template](!)
type=aor
max_contacts=1
remove_existing=yes

; Template для аутентификации слотов
[slot-auth-template](!)
type=auth
auth_type=userpass

; Template для Kamailio
[kamailio-template](!)
type=endpoint
context=internal
disallow=all
allow=ulaw
allow=alaw
allow=gsm
allow=g722
transport=transport-udp
aors=kamailio-aor
identify_by=ip,username

[kamailio-aor](!)
type=aor
contact=sip:kamailio:5060

; ============================================
; KAMAILIO CONNECTION
; ============================================

[kamailio]
type=endpoint
context=internal
disallow=all
allow=ulaw
allow=alaw
allow=gsm
allow=g722
transport=transport-udp
aors=kamailio
identify_by=ip,username
from_domain=vss.internal

[kamailio]
type=aor
contact=sip:kamailio:5060
qualify_frequency=60

[kamailio]
type=identify
endpoint=kamailio
match=172.19.0.0/255.255.0.0

[kamailio]
type=identify
endpoint=kamailio
match=127.0.0.0/255.0.0.0

; ============================================
; EXTERNAL PROVIDER TEMPLATE
; ============================================

[provider-template](!)
type=endpoint
context=outbound
disallow=all
allow=ulaw
allow=alaw
allow=g722
transport=transport-udp
from_domain=${PROVIDER_DOMAIN:-provider.example.com}
outbound_auth=provider-auth
aors=provider-aor

[provider-aor](!)
type=aor
contact=sip:${PROVIDER_HOST:-provider.example.com}:${PROVIDER_PORT:-5060}
qualify_frequency=30

[provider-auth](!)
type=auth
auth_type=userpass
username=${PROVIDER_USER:-provider_user}
password=${PROVIDER_PASSWORD:-provider_pass}

; ============================================
; REGISTRATION (для исходящих вызовов)
; ============================================

; Регистрация к внешнему провайдеру (если требуется)
;[provider-registration]
;type=registration
;transport=transport-udp
;outbound_auth=provider-auth
;server_uri=sip:${PROVIDER_HOST:-provider.example.com}:${PROVIDER_PORT:-5060}
;client_uri=sip:${PROVIDER_USER:-provider_user}@${PROVIDER_DOMAIN:-provider.example.com}
;contact_user=${PROVIDER_USER:-provider_user}
;retry_interval=60
;forbidden_retry_interval=300
;expiration=300
;auth_rejection_permanent=no
;max_retries=10
;outbound_proxy=sip:${PROVIDER_HOST:-provider.example.com}:${PROVIDER_PORT:-5060}
;fatal_retry_interval=30
;line=yes
;endpoint=provider-template


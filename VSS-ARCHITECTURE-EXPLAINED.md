# Детальное описание архитектуры VSS и механики взаимодействия ролей

## Содержание
1. [Общая архитектура системы VSS](#общая-архитектура-системы-vss)
2. [Компоненты системы](#компоненты-системы)
3. [Роли пользователей и их права](#роли-пользователей-и-их-права)
4. [Механика взаимодействия ролей](#механика-взаимодействия-ролей)
5. [Потоки данных (F-Flow)](#потоки-данных-f-flow)
6. [Детальная работа каждой роли](#детальная-работа-каждой-роли)

---

## Общая архитектура системы VSS

VSS (Virtual System Stack) - это комплексная платформа для управления гетерогенными коммуникационными слотами в реальном времени с полной SIP-маршрутизацией, автоматизацией и контролем на всех уровнях.

### Высокоуровневая схема

```
┌─────────────────────────────────────────────────────────┐
│                   VSS DEMIURGE PLATFORM                  │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
│  │    OTTB     │  │    DCI      │  │    WORKSPACE    │  │
│  │  Core       │  │  Data & CI  │  │  UI & CRM       │  │
│  └─────────────┘  └─────────────┘  └─────────────────┘  │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              POINT (RBAC & Auth)                   │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────┬───────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
┌───────────────────┐ ┌─────────────┐ ┌─────────────┐
│  CUSTOM GUACAMOLE │ │   PBX       │ │   Redis     │
│   Web Gateway     │ │ Asterisk/FS │ │   Queue     │
└─────────┬─────────┘ └─────────────┘ └─────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────┐
│                  PHYSICAL LAYER                          │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
│  │  AUTO HUB   │  │   MF HUB    │  │  LOCAL SCRIPT   │  │
│  │ 10+ slots   │  │ 20+ phones  │  │ PowerShell     │  │
│  │ Magneticola │  │ Mobile Farm │  │ AutoHotkey     │  │
│  └─────────────┘  └─────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### Три плоскости управления

1. **Control Plane** (Плоскость управления):
   - Управление слотами, статусами, заданиями
   - GACS скрипты
   - DCI синхронизация
   - Автодозвон (Lead Queue)
   - WebSocket телеметрия

2. **Media Plane** (Медиа плоскость):
   - Обработка SIP, RTP
   - RTMP видео/аудио потоки
   - Маршрутизация звонков
   - Запись звонков

3. **Access/Execution Plane** (Плоскость доступа/исполнения):
   - ADB команды
   - Power management
   - GUI автоматизация (GACS)
   - DRP (Device Recovery Protocol)

---

## Компоненты системы

### 1. VSS WORKSPACE (Порт: 3000)

**Роль:** Единое рабочее пространство и CRM интеграция

**Основные функции:**
- **UI Backend** - REST API для фронтенда
- **CRM интеграция** - управление лидами, клиентами, заметками
- **WebSocket сервер** - real-time обновления через Socket.IO
- **Dashboard API** - статистика и метрики
- **Guacamole интеграция** - управление удаленными подключениями
- **ARCHONTs управление** - для администраторов

**API эндпоинты:**
- `GET /api/dashboard` - данные дашборда
- `GET /api/crm/leads` - список лидов
- `POST /api/crm/note` - добавление заметки
- `GET /api/crm/notes/:call_id` - заметки по звонку
- WebSocket события: `call.update`, `slot.update`, `pipeline.update`

**База данных:**
- `crm_leads` - лиды и клиенты
- `calls` - звонки с привязкой к CRM
- `guacamole_sessions_audit` - аудит сессий Guacamole

---

### 2. VSS OTTB (Omni Telecom Trunk Builder) (Порт: 8083)

**Роль:** Управление телекоммуникациями и автодозвоном

**Основные функции:**
- **Управление транками и слотами** - создание, настройка, мониторинг
- **SIP нумерация и маршрутизация** - внутренние номера для слотов
- **Автодозвон** - автоматические кампании звонков
- **GACS управление** - GUI автоматизация скриптов
- **PBX интеграция** - работа с Kamailio и Asterisk
- **CDR и запись звонков** - сбор статистики

**Внутренняя SIP нумерация:**
- `6xxx` - AUTO слоты (6001, 6002, ...)
- `7xxx` - MF слоты (7001, 7002, ...)
- `8xxx` - LS слоты (8001, 8002, ...)
- `1xxx` - Сервисы (1001 - IVR, ...)

**API эндпоинты:**
- `GET /api/slots` - список всех слотов
- `POST /api/call/start` - начало звонка
- `POST /api/call/end` - завершение звонка
- `POST /api/autodialer/run-campaign` - запуск кампании
- `POST /api/gacs/run-script` - запуск GACS скрипта
- `GET /api/pbx/status` - статус транков
- `GET /api/cdr/records` - CDR записи
- `GET /api/monitor/system` - системные метрики

**Состояния слотов (FSM):**
```
IDLE → ASSIGNED → REGISTERING → READY → CALLING → ACTIVE_CALL → POSTCALL → IDLE
                                                                      ↓
                                                                    FAULT
```

---

### 3. VSS DCI (Distributed Control Infrastructure) (Порт: 8082)

**Роль:** Управление данными, CI/CD и логированием

**Основные функции:**
- **Управление PostgreSQL** - основной БД
- **CI/CD пайплайны** - автоматизация развертывания
- **Логирование и аналитика** - события системы
- **Event processing** - обработка событий RabbitMQ
- **DCI узлы** - управление периферийными узлами

**API эндпоинты:**
- `GET /api/dci/pipelines` - список пайплайнов
- `POST /api/dci/pipeline/:id/run` - запуск пайплайна
- `GET /api/dci/logs` - логи системы
- `POST /api/dci/log-event` - логирование события

**База данных:**
- `events_log` - все события системы
- `ci_pipelines` - пайплайны CI/CD
- Основные таблицы: `users`, `roles`, `slots`, `trunks`, `calls`

---

### 4. VSS POINT (Порт: 8081)

**Роль:** Безопасность, аутентификация и RBAC

**Основные функции:**
- **JWT аутентификация** - вход в систему
- **RBAC (Role-Based Access Control)** - управление правами
- **Управление ролями** - создание и настройка ролей
- **Управление пользователями** - CRUD операции
- **Проверка прав** - валидация доступа к ресурсам

**API эндпоинты:**
- `POST /api/auth/login` - вход в систему
- `POST /api/auth/refresh` - обновление токена
- `GET /api/users` - список пользователей
- `POST /api/users` - создание пользователя
- `GET /api/roles` - список ролей
- `GET /api/point/rolecheck?action=...` - проверка прав

**База данных:**
- `users` - пользователи системы
- `roles` - роли с правами (JSONB)
- `security_audit_log` - аудит безопасности

---

### 5. Дополнительные компоненты

**Guacamole** - Web Gateway для удаленного доступа к слотам
- Протоколы: RDP, VNC, SSH, Telnet
- Интеграция с VSS аутентификацией
- Аудит всех сессий

**Kamailio + Asterisk** - SIP PBX
- Kamailio: маршрутизация SIP
- Asterisk: обработка медиа (RTP), IVR, запись

**RabbitMQ** - Message Queue
- Очереди для автодозвона (F-01)
- События системы (F-Flow)
- Команды управления

**Redis** - Кэш и очереди
- Кэширование статусов
- Быстрый доступ к данным

**PostgreSQL** - Основная база данных
- Все данные системы
- ACID транзакции
- JSONB для гибких структур

---

## Роли пользователей и их права

### 1. Администратор (admin)

**Права доступа:**
```json
{
  "all": true,
  "permissions": {
    "users": ["create", "read", "update", "delete"],
    "roles": ["create", "read", "update", "delete"],
    "slots": ["create", "read", "update", "delete", "admin"],
    "trunks": ["create", "read", "update", "delete"],
    "calls": ["read", "monitor", "record"],
    "archonts": ["create", "read", "update", "delete"],
    "system": ["configure", "monitor", "restart"],
    "crm": ["read", "write", "admin"],
    "reports": ["read", "generate"],
    "pipelines": ["run", "stop", "create"]
  }
}
```

**Guacamole права:**
- Все протоколы (RDP, VNC, SSH)
- Неограниченное количество подключений
- Доступ ко всем слотам
- Полный контроль

**Доступные API:**
- Все эндпоинты всех сервисов
- `/api/users/*` - управление пользователями
- `/api/roles/*` - управление ролями
- `/api/archonts/*` - управление ARCHONTs
- `/api/dci/pipelines/*` - управление CI/CD
- `/api/monitor/*` - полный мониторинг
- `/api/system/*` - системные операции

---

### 2. Оператор (operator)

**Права доступа:**
```json
{
  "permissions": {
    "calls": true,
    "slots": true,
    "crm": ["read", "write"],
    "notes": ["create", "read"]
  }
}
```

**Guacamole права:**
- Ограниченные протоколы (по назначению)
- Максимум 5 подключений
- Доступ только к назначенным слотам
- Таймаут сессии: 3600 секунд

**Доступные API:**
- `/api/slots` - просмотр слотов
- `/api/call/start` - начало звонка
- `/api/call/end` - завершение звонка
- `/api/calls/feed` - live feed звонков
- `/api/crm/leads` - просмотр лидов
- `/api/crm/note` - создание заметок
- `/api/guacamole/connect` - подключение к слоту (только назначенным)

**Ограничения:**
- Не может создавать/удалять пользователей
- Не может управлять системными настройками
- Не может перезапускать систему
- Не может управлять ARCHONTs

---

### 3. Продавец (seller)

**Права доступа:**
```json
{
  "permissions": {
    "crm": true,
    "leads": true,
    "calls": ["read"],
    "notes": ["create", "read", "update"]
  }
}
```

**Guacamole права:**
- Минимальный доступ
- Только просмотр (read-only режим, если применимо)
- Ограниченные протоколы

**Доступные API:**
- `/api/crm/leads` - управление лидами
- `/api/crm/note` - заметки
- `/api/calls` - просмотр звонков (только свои/назначенные)
- `/api/dashboard` - статистика по своим лидам

**Ограничения:**
- Не может управлять слотами
- Не может инициировать звонки напрямую
- Не может подключаться к слотам через Guacamole
- Работает только с CRM функционалом

---

### 4. Супервизор (supervisor)

**Права доступа:**
```json
{
  "permissions": {
    "read": true,
    "report": true,
    "monitor": true,
    "calls": ["read", "monitor"],
    "users": ["read"],
    "slots": ["read", "monitor"],
    "crm": ["read"]
  }
}
```

**Guacamole права:**
- Мониторинг подключений
- Чтение логов сессий
- Ограниченный доступ для диагностики

**Доступные API:**
- `/api/dashboard` - полный дашборд
- `/api/calls/feed` - мониторинг всех звонков
- `/api/slots` - просмотр всех слотов
- `/api/monitor/*` - системный мониторинг
- `/api/reports/*` - генерация отчетов
- `/api/cdr/records` - просмотр CDR
- `/api/users` - просмотр пользователей (read-only)
- `/api/dci/logs` - просмотр логов

**Ограничения:**
- Не может изменять системные настройки
- Не может управлять пользователями (только просмотр)
- Не может инициировать звонки
- Не может управлять ARCHONTs

---

## Механика взаимодействия ролей

### Процесс аутентификации (POINT)

1. **Логин:**
   ```
   Пользователь → POST /api/auth/login (POINT:8081)
   ↓
   Проверка username/password в PostgreSQL
   ↓
   Получение роли и прав из таблицы roles
   ↓
   Генерация JWT токена с role и permissions
   ↓
   Обновление last_login в таблице users
   ↓
   Возврат токена клиенту
   ```

2. **Использование токена:**
   ```
   Все последующие запросы:
   Headers: Authorization: Bearer <jwt_token>
   ↓
   POINT проверяет токен
   ↓
   Извлекает role и permissions
   ↓
   Передает в другие сервисы для проверки прав
   ```

---

### Процесс работы оператора

**Сценарий: Инициация звонка**

1. **Подключение к системе:**
   ```
   Оператор → POST /api/auth/login
   ↓
   Получение JWT токена (role: operator)
   ```

2. **Просмотр доступных слотов:**
   ```
   Оператор → GET /api/slots (WORKSPACE:3000)
   ↓
   WORKSPACE → GET /api/slots (OTTB:8083) с токеном
   ↓
   OTTB проверяет права (operator может видеть слоты)
   ↓
   Возврат списка свободных слотов
   ```

3. **Начало звонка:**
   ```
   Оператор → POST /api/call/start
   Body: { "slot_id": 44, "phone_number": "+79991234567" }
   ↓
   WORKSPACE проверяет права оператора
   ↓
   WORKSPACE → POST /api/call/start (OTTB:8083)
   ↓
   OTTB:
     - Проверяет статус слота (должен быть READY)
     - Создает запись в БД (calls)
     - Отправляет команду через RabbitMQ (F-01) в DCI
     - Изменяет статус слота на BUSY
   ↓
   DCI получает команду:
     - Находит свободный AUTO/MF/LS слот
     - Регистрирует SIP (F-09)
     - Инициирует SIP INVITE через Kamailio (F-03)
     - Обновляет статус через WebSocket (F-05)
   ↓
   OTTB отправляет событие в RabbitMQ (F-05)
   ↓
   WORKSPACE получает событие → WebSocket клиентам
   ↓
   Оператор видит обновление в реальном времени
   ```

4. **Работа со звонком:**
   ```
   Во время звонка:
   - RTMP поток (F-04) от слота к NGINX
   - RTP медиа (F-10) через Asterisk
   - Обновления статуса через WebSocket (F-05)
   - Запись звонка (F-14) если включена
   ```

5. **Завершение звонка:**
   ```
   Оператор → POST /api/call/end
   ↓
   OTTB:
     - Завершает SIP сессию
     - Обновляет запись в БД (calls.status = 'ended')
     - Освобождает слот (status = 'free')
     - Обновляет CDR (F-13)
   ↓
   События через RabbitMQ и WebSocket
   ```

6. **Добавление заметки в CRM:**
   ```
   Оператор → POST /api/crm/note
   Body: { "call_id": "c_882", "text": "Клиент заинтересован" }
   ↓
   WORKSPACE сохраняет в БД
   ↓
   Привязывает к лиду в crm_leads
   ```

---

### Процесс работы продавца

**Сценарий: Работа с лидами**

1. **Просмотр лидов:**
   ```
   Продавец → GET /api/crm/leads?assigned_seller=<seller_id>
   ↓
   WORKSPACE запрашивает из PostgreSQL:
     SELECT * FROM crm_leads 
     WHERE assigned_seller = <seller_id>
   ↓
   Возврат списка лидов
   ```

2. **Просмотр истории звонков по лиду:**
   ```
   Продавец → GET /api/calls?lead_id=<lead_id>
   ↓
   WORKSPACE:
     - Проверяет права (seller может видеть только свои лиды)
     - Запрашивает звонки из БД
     - Возврат с заметками и метаданными
   ```

3. **Создание/обновление лида:**
   ```
   Продавец → POST /api/crm/leads
   Body: { "client_name": "...", "phone": "...", "status": "new" }
   ↓
   WORKSPACE создает запись в crm_leads
   ↓
   Автоматическое присвоение assigned_seller = seller_id
   ```

4. **Просмотр статистики:**
   ```
   Продавец → GET /api/dashboard
   ↓
   WORKSPACE:
     - Фильтрует данные по assigned_seller
     - Возвращает статистику только по своим лидам
   ```

**Ограничения продавца:**
- Не видит чужих лидов
- Не может инициировать звонки напрямую
- Не имеет доступа к слотам

---

### Процесс работы супервизора

**Сценарий: Мониторинг операций**

1. **Просмотр дашборда:**
   ```
   Супервизор → GET /api/dashboard
   ↓
   WORKSPACE:
     - Агрегирует данные из всех источников
     - Активные звонки
     - Статистика по операторам
     - Статус слотов
     - Метрики производительности
   ```

2. **Мониторинг звонков в реальном времени:**
   ```
   Супервизор подключается к WebSocket:
   socket.on('subscribe:calls')
   ↓
   WORKSPACE подписывает на все события звонков
   ↓
   Получает все обновления:
   - call.update
   - slot.update
   ↓
   Может видеть все звонки всех операторов
   ```

3. **Просмотр отчетов:**
   ```
   Супервизор → GET /api/reports/daily?date=2025-01-15
   ↓
   WORKSPACE:
     - Агрегирует данные из БД
     - Группирует по операторам
     - Статистика звонков, длительность, результаты
   ↓
   Возврат отчета
   ```

4. **Просмотр логов:**
   ```
   Супервизор → GET /api/dci/logs?module=OTTB&severity=error
   ↓
   DCI фильтрует события из events_log
   ↓
   Возврат логов
   ```

5. **Мониторинг слотов:**
   ```
   Супервизор → GET /api/monitor/slots
   ↓
   OTTB:
     - Собирает метрики со всех слотов
     - CPU, RAM, температура, батарея
     - Статусы подключений
   ↓
   Возврат детальной информации
   ```

**Особенности супервизора:**
- Видит все данные (read-only)
- Может генерировать отчеты
- Может мониторить в реальном времени
- Не может изменять настройки

---

### Процесс работы администратора

**Сценарий: Управление системой**

1. **Создание пользователя:**
   ```
   Администратор → POST /api/users
   Body: {
     "username": "op21",
     "password": "secure123",
     "email": "op21@example.com",
     "role": "operator"
   }
   ↓
   POINT:
     - Проверяет права (admin имеет "users": ["create"])
     - Хеширует пароль (bcrypt)
     - Создает запись в users
     - Привязывает к роли из roles
   ↓
   Логирование в security_audit_log
   ```

2. **Создание нового ARCHONT центра:**
   ```
   Администратор → POST /api/archonts/centers
   Body: {
     "name": "Call Center 1",
     "template_id": 1,
     "created_by": "admin_uuid"
   }
   ↓
   WORKSPACE:
     - Создает запись в archont_centers
     - Разворачивает инфраструктуру по шаблону
     - Создает транки и слоты
     - Настраивает SIP маршруты
   ↓
   Генерация событий через RabbitMQ
   ```

3. **Управление транками:**
   ```
   Администратор → POST /api/trunks
   Body: {
     "name": "AUTO HUB 1",
     "type": "auto",
     "capacity": 10
   }
   ↓
   OTTB:
     - Создает запись в trunks
     - Генерирует внутренние SIP номера для слотов
     - Создает конфигурацию для Kamailio
     - Обновляет dialplan в Asterisk
   ```

4. **Запуск CI/CD пайплайна:**
   ```
   Администратор → POST /api/dci/pipeline/:id/run
   ↓
   DCI:
     - Проверяет права (admin)
     - Запускает пайплайн
     - Обновляет статус в ci_pipelines
     - Логирует события в events_log
   ```

5. **Системный мониторинг:**
   ```
   Администратор имеет доступ ко всем метрикам:
   - GET /api/monitor/system - системные ресурсы
   - GET /api/monitor/network - сетевые метрики
   - GET /api/monitor/usb - статус USB HUB
   - GET /api/monitor/slots/:id - детальная информация о слоте
   ```

---

## Потоки данных (F-Flow)

### F-01: Autodial Lead Queue
**Назначение:** Доставка лидов для автодозвона
```
HUB → RabbitMQ → Slot
Протокол: RabbitMQ
Направление: HUB → Slot
Компонент: Autodialer / Agent
```

**Процесс:**
1. OTTB получает команду запуска кампании
2. Помещает лиды в очередь RabbitMQ
3. DCI узлы потребляют лиды из очереди
4. Слоты обрабатывают лиды по очереди

---

### F-02: GACS Script Execution
**Назначение:** Выполнение GUI автоматизации
```
HUB → SSH/ADB → Slot
Протокол: SSH / ADB
Направление: HUB → Slot
Компонент: GACS Executor
```

**Процесс:**
1. Администратор/Оператор запускает GACS скрипт
2. OTTB отправляет команду через RabbitMQ
3. DCI узел получает команду
4. Выполнение через ADB/GUI автоматизацию
5. Логирование результатов (F-12)

---

### F-03: SIP Outbound Call
**Назначение:** Исходящий звонок
```
Slot → SIP/RTP → Kamailio → PSTN
Протокол: SIP / RTP
Направление: Slot → Kamailio → External
Компонент: PJSIP / Asterisk Agent
```

**Процесс:**
1. Слот инициирует SIP INVITE
2. Kamailio маршрутизирует запрос
3. Asterisk обрабатывает медиа (RTP)
4. Подключение к внешнему провайдеру
5. Установка соединения

---

### F-04: RTMP Video/Audio Push
**Назначение:** Передача видео с устройства
```
Slot → RTMP → NGINX → Frontend
Протокол: RTMP / HLS
Направление: Slot → NGINX
Компонент: FFmpeg / Camera Capture
```

**Процесс:**
1. Слот захватывает видео/аудио
2. Кодирование через FFmpeg
3. Отправка RTMP потока в NGINX
4. Транскодирование в HLS для веб-плеера
5. Просмотр в реальном времени в интерфейсе

---

### F-05: Slot Status Sync
**Назначение:** Обновление статуса слота
```
Slot → WebSocket → HUB
Протокол: WebSocket (Socket.IO)
Направление: Slot → HUB
Компонент: HUB Master
```

**Процесс:**
1. Слот изменяет состояние (READY → BUSY)
2. Отправка через WebSocket в WORKSPACE
3. WORKSPACE обновляет БД
4. Трансляция всем подписанным клиентам
5. Обновление UI в реальном времени

---

### F-06: Hardware DRP
**Назначение:** Аппаратный контроль
```
DCI → SSH/uhubctl → Device
Протокол: SSH / uhubctl
Направление: DCI → Device
Компонент: Power Cycle Module
```

**Процесс:**
1. Обнаружение проблемы со слотом
2. DCI инициирует DRP операцию
3. USB Power Cycle через uhubctl
4. Перезагрузка устройства
5. Восстановление работы

---

### F-09: SIP Registration
**Назначение:** Регистрация слотов в SIP
```
Slot → SIP REGISTER → Kamailio
Протокол: SIP
Направление: Slot → Kamailio
Компонент: SIP Agent
```

**Процесс:**
1. При создании слота OTTB генерирует SIP учетные данные
2. Слот отправляет SIP REGISTER в Kamailio
3. Kamailio сохраняет регистрацию
4. Слот получает статус REGISTERED
5. Слот готов к приему/исходящим звонкам

---

### F-10: SIP Media RTP
**Назначение:** Медиа поток звонка
```
Slot ↔ RTP ↔ Asterisk
Протокол: RTP / RTCP
Направление: Slot ↔ Asterisk
Компонент: SIP Agent / PBX
```

**Процесс:**
1. После установления SIP соединения
2. Asterisk инициирует RTP медиа сессию
3. Обмен аудио/видео пакетами
4. Контроль качества через RTCP
5. Завершение при окончании звонка

---

### F-13: CDR Collection
**Назначение:** Сбор CDR записей
```
SIP Trunk → PostgreSQL → DCI DB
Протокол: PostgreSQL / SQL
Направление: Asterisk → DCI
Компонент: Asterisk / Kamailio
```

**Процесс:**
1. Asterisk генерирует CDR при завершении звонка
2. Запись в таблицу calls в PostgreSQL
3. Дополнительные метрики в CDR
4. Доступ через API для отчетов

---

### F-14: SIP Call Recording
**Назначение:** Запись звонков
```
SIP Trunk → RTP → Storage
Протокол: RTP → Storage
Направление: Asterisk → Storage
Компонент: Asterisk Recorder
```

**Процесс:**
1. Asterisk записывает RTP поток
2. Сохранение в аудио/видео формат
3. Сохранение на диске/объектном хранилище
4. Привязка к записи в БД
5. Доступ через API

---

## Детальная работа каждой роли

### Администратор - Полный цикл управления

**1. Инициализация системы:**
- Создание ролей и прав
- Настройка транков
- Развертывание ARCHONTs центров
- Конфигурация SIP маршрутов

**2. Управление пользователями:**
- Создание/редактирование/удаление пользователей
- Назначение ролей
- Управление правами Guacamole

**3. Управление инфраструктурой:**
- Создание/удаление транков
- Настройка слотов
- Конфигурация DCI узлов
- Запуск CI/CD пайплайнов

**4. Мониторинг:**
- Системные метрики
- Логи всех сервисов
- Аудит безопасности
- Производительность

---

### Оператор - Рабочий процесс

**1. Вход в систему:**
- Аутентификация через POINT
- Получение JWT токена
- Подключение к WebSocket для обновлений

**2. Рабочий день:**
- Просмотр доступных слотов
- Инициация звонков
- Работа со звонками в реальном времени
- Добавление заметок в CRM

**3. Управление звонками:**
- Прием входящих звонков (если настроено)
- Исходящие звонки по лидам
- Мониторинг статуса звонков
- Завершение звонков

**4. Работа с CRM:**
- Просмотр назначенных лидов
- Обновление статусов лидов
- Создание заметок
- Привязка звонков к лидам

---

### Продавец - CRM фокус

**1. Работа с лидами:**
- Создание новых лидов
- Просмотр назначенных лидов
- Обновление информации о клиентах
- Изменение статусов лидов

**2. Аналитика:**
- Статистика по своим лидам
- История звонков по клиентам
- Заметки и комментарии
- Конверсия лидов

**3. Коммуникация:**
- Просмотр звонков (read-only)
- Прослушивание записей звонков
- Чтение заметок операторов

---

### Супервизор - Мониторинг и контроль

**1. Мониторинг в реальном времени:**
- Dashboard с обзором всей системы
- Live feed всех звонков
- Статусы всех слотов
- Активность операторов

**2. Отчетность:**
- Генерация отчетов по периодам
- Статистика по операторам
- Анализ производительности
- Экспорт данных

**3. Диагностика:**
- Просмотр логов системы
- Анализ ошибок
- Мониторинг здоровья системы
- Выявление проблем

---

## Заключение

VSS - это комплексная система с четким разделением ролей и полным контролем доступа. Каждая роль имеет свои права и возможности, что обеспечивает безопасность и эффективность работы.

**Ключевые особенности:**
- ✅ Четкое разделение ролей через RBAC
- ✅ Real-time обновления через WebSocket
- ✅ Полный аудит всех действий
- ✅ Масштабируемая архитектура
- ✅ Интеграция всех компонентов
- ✅ Гибкая система прав доступа

**Безопасность:**
- JWT аутентификация
- Проверка прав на каждом уровне
- Аудит всех операций
- Шифрование паролей
- Ограничение доступа к ресурсам

---

**Версия документа:** 1.0  
**Дата:** 2025-01-XX  
**Автор:** VSS Engineering Team


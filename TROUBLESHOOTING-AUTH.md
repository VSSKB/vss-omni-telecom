# Устранение проблем с авторизацией

## Проблема: "Ошибка сети при попытке входа"

### Возможные причины и решения

#### 1. База данных не инициализирована

**Симптомы:**
- Ошибка "Ошибка сети при попытке входа"
- В логах сервера: "База данных не инициализирована"

**Решение:**
1. Проверьте, что модуль `sqlite3` установлен:
   ```bash
   npm install sqlite3
   ```

2. Проверьте, что директория `db_data` существует и доступна для записи

3. Перезапустите сервер

#### 2. Ошибка подключения к базе данных

**Симптомы:**
- Ошибка в логах: "Ошибка открытия базы данных"
- Файл `db_data/auth.db` не создается

**Решение:**
1. Убедитесь, что у процесса есть права на запись в директорию `db_data`
2. Проверьте, что директория `db_data` существует:
   ```bash
   mkdir -p db_data
   ```
3. Удалите файл `db_data/auth.db` и перезапустите сервер (база создастся заново)

#### 3. Пользователь не найден

**Симптомы:**
- Ошибка "Неверное имя пользователя или пароль"
- База данных инициализирована, но пользователь не создан

**Решение:**
1. Проверьте, что пользователь по умолчанию создан:
   - Username: `admin`
   - Password: `admin123`

2. Если пользователь не создан, перезапустите сервер - он создастся автоматически

3. Или создайте пользователя через API:
   ```bash
   curl -X POST http://localhost:3000/api/admin-register \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123","role":"admin"}'
   ```

#### 4. Проблемы с модулем sqlite3

**Симптомы:**
- Ошибка при импорте модуля
- "Cannot find module 'sqlite3'"

**Решение:**
1. Переустановите модуль:
   ```bash
   npm uninstall sqlite3
   npm install sqlite3
   ```

2. На Windows может потребоваться установка build tools:
   ```bash
   npm install --global windows-build-tools
   ```

#### 5. Проверка работы базы данных

**Тест инициализации:**
```bash
node -e "const authDB = require('./database/auth-db'); setTimeout(async () => { try { await authDB.ensureInitialized(); console.log('OK'); const users = await authDB.getAllUsers(); console.log('Users:', users.length); } catch(e) { console.error('Error:', e.message); } process.exit(0); }, 3000);"
```

**Проверка файла базы данных:**
```bash
# Windows
dir db_data\auth.db

# Linux/Mac
ls -la db_data/auth.db
```

#### 6. Логирование

Включите детальное логирование:
- Откройте консоль браузера (F12)
- Проверьте логи сервера в терминале
- Ищите сообщения с префиксом `[AUTH]` или `[LOGIN]`

#### 7. Проверка API

Проверьте, что API доступен:
```bash
curl -X POST http://localhost:3000/api/admin-login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### 8. Сброс базы данных

Если ничего не помогает, удалите базу данных и перезапустите сервер:
```bash
# Windows
del db_data\auth.db

# Linux/Mac
rm db_data/auth.db
```

После перезапуска сервера база данных и пользователь по умолчанию создадутся автоматически.

## Контакты для поддержки

Если проблема не решена, проверьте:
1. Логи сервера
2. Консоль браузера (F12)
3. Файл `db_data/auth.db` существует и доступен


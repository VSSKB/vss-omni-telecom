# Исправление проблем при запуске проектов

## Проблемы

1. **Устаревший атрибут `version`** в docker-compose.yml вызывает предупреждения
2. **Порты заняты** - при запуске проекта порты могут быть уже заняты другими контейнерами
3. **Контейнеры не запускаются** - из-за конфликтов портов

## Решение

### 1. Автоматическое удаление устаревшего атрибута `version`

При создании проекта и при запуске система автоматически удаляет строку `version: '3.8'` из docker-compose.yml.

### 2. Проверка и исправление портов при запуске

При запуске проекта (`POST /api/projects/:id/start`) система:
1. Читает docker-compose.yml
2. Извлекает все порты из секции `ports:`
3. Проверяет доступность каждого порта:
   - Системная доступность
   - Использование в Docker контейнерах
   - Использование в других проектах
4. Если порт занят - автоматически находит свободный и заменяет в docker-compose.yml
5. Сохраняет исправленный файл
6. Запускает проект

### 3. Исправление образа mikopbx

Образ `hello-world` заменен на `nginx:alpine`, так как `hello-world` сразу завершается и вызывает постоянные перезапуски.

## Пример работы

```
[PROJECT START] Порт 5672 занят, ищем свободный...
[PROJECT START] Порт 5672 заменен на 5673
[PROJECT START] docker-compose.yml обновлен с исправленными портами
```

## Логи

Все изменения портов логируются в консоль для отладки.

---

**Версия:** 1.0  
**Дата:** 2025-01-XX


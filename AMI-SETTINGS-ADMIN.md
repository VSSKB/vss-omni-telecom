# Настройки AMI в админке проекта

## Описание

Настройки AMI (Asterisk Manager Interface) теперь вынесены в админку проекта и сохраняются в файл `config.json`.

## Что изменилось

### 1. Хранение настроек

Настройки AMI теперь хранятся в файле `/app/config.json`:
```json
{
  "ami": {
    "host": "213.165.48.17",
    "port": 6038,
    "username": "vss_1",
    "password": "QmlVdWNndTdRYlk9"
  }
}
```

### 2. Загрузка настроек

При старте сервера настройки загружаются из `config.json`. Если файл не существует, используются значения по умолчанию или переменные окружения.

### 3. API для управления настройками

**GET `/api/config/ami`** - Получить текущие настройки AMI
```json
{
  "success": true,
  "config": {
    "host": "213.165.48.17",
    "port": 6038,
    "username": "vss_1",
    "password": "***"
  }
}
```

**PUT `/api/config/ami`** - Сохранить новые настройки AMI
```json
{
  "host": "213.165.48.17",
  "port": 6038,
  "username": "vss_1",
  "password": "QmlVdWNndTdRYlk9"
}
```

После сохранения настройки автоматически применяются и происходит переподключение к AMI.

### 4. Интерфейс в админке

Добавлена секция "Настройки AMI" в админ-панели с полями:
- IP-адрес или хост
- Порт
- Имя пользователя
- Пароль

Кнопки:
- **Сохранить и применить** - сохраняет настройки и переподключается к AMI
- **Загрузить текущие** - загружает текущие настройки из сервера

## Использование

1. Откройте админ-панель проекта
2. Войдите в систему
3. Перейдите в секцию "Настройки AMI"
4. Заполните поля с настройками AMI
5. Нажмите "Сохранить и применить"
6. Система автоматически переподключится к AMI с новыми настройками

## Приоритет настроек

1. **Переменные окружения** (если установлены):
   - `AMI_HOST`
   - `AMI_PORT`
   - `AMI_USERNAME`
   - `AMI_PASSWORD`

2. **Файл config.json** (если существует)

3. **Значения по умолчанию** (хардкод в коде)

## Исправление ошибки "Manager is not a constructor"

Добавлена проверка импорта `asterisk-manager` и обработка ошибок при создании Manager. Если пакет не установлен или импорт не удался, система покажет понятное сообщение об ошибке.

---

**Версия:** 1.0  
**Дата:** 2025-01-XX

